{% extends "base.html" %}

{% block content %}

<!--Grabs relevant information from the MongoDB database and fills the page-->
<div class="row">
    <div class="col s12">
        <div class="card-panel green darken-3">
            <div class="row">
                <a href="{{ url_for('library') }}" class="right white-text pink darken-3 btn">Return to Library</a>
            </div>
            <hr>
            <div class="row">
                <div class="col s6 offset-s3 m4 l3">
                    <img class="activator book-image" src="{{ book_id.book_cover }}" href="{{ book_id.book_url }}">
                </div>
                <div class="col s12 m8 l9">
                    <h3 class="member-info tagline">{{ book_id.book_name }}</h3>
                    <h4 class="member-info tagline">By {{ book_id.book_author }}</h4>
                    <br>
                    <p class="white-text">{{ book_id.book_description }}</p>
                    <br>
                    <a href="{{ book_id.book_url }}" target="_blank" class="pink darken-3 waves-effect waves-light btn">Get a Copy</a>
                    <a href="{{ url_for ('add_review', book_id=book_id._id) }}" class="pink darken-3 waves-effect waves-light btn">Leave a Review</a>
                </div>
            </div>
            <hr>
            <div class="row">
                <h4 class="tagline">Reviews</h4>
            </div>
            <div>  
                <div class="row">
                    <!--iterates through reviews for specific book and shows them below-->
                    {% if user_reviews|length > 0 %}
                        {% for review in user_reviews %}
                           <div class="col s12">
                                <div class="card">
                                    <div class="card-content green darken-4">
                                        <span class="card-title white-text">{{ review.book_rating }} Stars</span>
                                        <p class="white-text">{{ review.book_review }}</p>
                                        <p class="white-text">{{ review.username }}</p>
                                        <p class="white-text"><i>{{ review.review_date }}</i></p>
                                    </div>
                                    {% if session.user|lower == review.username|lower %}
                                        <div class="card-action green darken-4">
                                            <a href="{{ url_for ('edit_review', book_id=book_id._id) }}" class="pink darken-3 waves-effect waves-light btn">Edit Review</a>
                                            <a href="{{ url_for ('delete_review', book_id=book_id._id) }}" class="pink darken-3 waves-effect waves-light btn">Delete Review</a>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    <!--if no reviews available, user invited to leave one-->
                    {% else %}
                        <div class="s12">
                            <h4 class="tagline center-align">This book has no reviews. Why don't you leave one?</h4>
                            <div class="center-align">
                                <a href="{{ url_for ('add_review', book_id=book_id._id) }}" class="pink darken-3 waves-effect waves-light btn">Leave a Review</a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>       
        </div>
    </div>
</div>

{% endblock %}